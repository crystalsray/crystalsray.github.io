<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Identify the Principal Strata for Your Study</title>
    <link rel="stylesheet" href="css/foundation.min.css">
    <link rel="stylesheet" href="css/app.css">
    <!--<link rel="stylesheet" href="css/editablegrid.css" type="text/css" media="screen">-->
    <script src="js/mathjs-master/dist/math.js"></script>

  </head>
  <body>
    

    <div class="callout large primary">
      <div class="row column text-center">
        <h1>Principal Stratification Tool</h1>
      </div>
    </div>
    
    <div class="row" id="content">

      <div class="medium-3 medium-offset-1 columns" data-sticky-container>
        <div class="sticky" data-sticky data-anchor="content">
          <ol class="menu vertical">
            <li><a href="index.html"><strong>Start &rarr;</strong> Calculating Bounds for Principal Causal Effects: Interactive Analysis Tool</a></li>
            <li class="active"><!-- PS_tool.html --> Identify the Principal Strata for your Study</a></li>
            <li><!-- exclusions_3.html -->Use Substantive Assumptions to Restrict the Number of Strata of Interest for these Analyses</li>
            <li><!-- bounds.html --> Determining Proportions of Subgroups using Observed Quantities</li>
            <li ><!-- pUnknown.html -->Solving for Proportions that are not Directly Observed</li>
            <li><!-- meansIntro.html -->Solving for Means under Treatment and Control</li>
            <li><!-- Bounds_calc.html -->Calculating the Bounds and Estimating Ranges of Impact</li>
          </ol>
        </div>
      </div>

      <div class="medium-7 columns">

          <h2>Identify the Principal Strata for Your Study</h2>
          <p> Please fill in the following information needed to estimate bounds for principal causes effects</p>
          <h3> 1. How many groups are you interested in comparing? </h3>
          <p> The first step is to identify the post-randomization activities that you want to examine for this study.   These are behaviors and actions that might be possible for study participants under both assignment to the treatment condition and under assignment to the control condition.  In the  Miratrix et al. 2016 study of Early College High schools, researchers focused on enrollment in different types of high schools; students could enroll at an Early College High schools, high-quality public schools or low -quality public schools. </p>

          <p>This tool is designed to support the calculation of bounds for principal causal effects for two, three or four conditions defined by post-randomization activities or behaviors. Please indicate the number of post-randomization actions / behaviors for which you wish to estimate bounds in this study. </p>

          <div class="dropdown">
          <select name="Quantity" id="selection"> 
            <option value=0> </option> 
            <option value=2>2</option> 
            <option value=3>3</option> 
            <option value=4>4</option> 
          </select>
          </div>

          <h3> 2. What do you call the conditions in your study? </h3>
          <p> Principal stratification is a method designed for analyses of randomized control studies with units assigned to treatment and a control groups. Please use the field below to reflect the specific names for the treatment and control conditions in your study. </p>

          <div id="namingGroups" class="header">
            <form action="demo_form.asp">
              <div class="row">
                <div class="medium-2 columns">
                  <label for="group1" >Treatment</label>
                </div>
                <div class="medium-10 columns">
                  <input type="text" id="group1" placeholder="Treatment">
                </div>
              </div>

              <div class="row">
                <div class="medium-2 columns">
                  <label for="group2">Control</label>
                </div>
                <div class="medium-10 columns">
                  <input type="text" id="group2" placeholder="Control"><br>
                </div>
              </div>

            </form>
          </div> 

          <h3> 3. For which strata are you interested in calculating bounds for the effects of treatment?  </h3>
          <p> Principal stratification allows you to estimate impacts on strata, or subgroups that you can determine after random assignment. These groups are based on the experimental subjects’ observed and counterfactual post-randomization actions and behaviors. Please label the strata of interest for this study. By default, the tool labels the conditions as "Condition1", “Condition2”, and “Condition3”. You may edit these fields to reflect the condition of interest for your study. For example, in the Miratrix et. al. Early College High School (ECHS) example, we would label the treatment condition as “ECHS” and the alternate conditions as “Low Quality High School” and “High Quality High School.” </p>


          <div id="myDIV" class="header">
            <div class="row">
                <div class="medium-2 columns">
                  <label for="subgroup1">Condition 1</label>
                </div>
                <div class="medium-10 columns">
                  <input type="text" id="subgroup1" placeholder="Condition1">
                </div>
            </div>

            <div class="row">
                <div class="medium-2 columns">
                  <label for="subgroup2">Condition 2</label>
                </div>
                <div class="medium-10 columns">
                 <input type="text" id="subgroup2" placeholder="Condition2">
                </div>
            </div>


            <div class="row">
                <div class="medium-2 columns">
                  <label for="subgroup3">Condition 3</label>
                </div>
                <div class="medium-10 columns">
                  <input type="text" id="subgroup3" placeholder="Condition3">
                </div>
            </div>

          </div>


          <h4>4. What is the outcome of interest for your study? </h4>
          <p> Please indicate an outcome of interest for your study  Note:  the tool only supports binary outcomes </p>
          <form action="demo_form.asp">
              <div class="row">
                <div class="medium-3 columns">
                  <label for="outcome">Outcome</label>
                </div>
                <div class="medium-9 columns">
                  <input type="text" id="outcome" placeholder="Outcome...">
                </div>
              </div>
           </form>

          <h4> 5. What is the estimated intent-to-treat effects on this outcome for your full sample? </h4>
          <p>Please enter in the outcome units rather effect size units. This this should be a percentage point difference between treatment and that ranges between -100 and 100</p>

          <div class="row">
            <form action="demo_form.asp">
              <div class="medium-2 columns">
                <label for="outcome_units">Estimated Effect</label>
              </div>
              <div class="medium-10 columns">
                <input type="text" id="outcome_units" placeholder="%">
              </div>
            </form>
          </div> <!--/row-->


          <p id="exp" class="callout success"> </p>

          <div id="dvTable" align="center">

          </div>

          


        <div class="row">
            <div class="small-12 text-center">
              <button class="button" onclick="generateFunction()">Continue</button>
            </div>
        </div>

      </div> <!--/ end medium- 7-->

      
      <div class="medium-1 columns">&nbsp;</div>

    </div><!--/ end row -->
    

    <footer>
      <div class="row expanded callout secondary">
        <div class="medium-10 medium-offset-1 columns">
      <p>Funding for this project was provided through a grant from Spencer Foundation. This website is designed to assist researchers interested in applying a principal stratification approach to their research questions. This tool intended for researchers who have a familiarity with the principal stratification approach. Researchers unfamiliar with the approach are encouraged to consult <a href="https://gspp.berkeley.edu/assets/uploads/research/pdf/Principal_Stratification.pdf" target="_blank">Page <em>et al</em> 2015 </a>  before using this tool. </p>

        </div>
      </div>


      <!--<div class="row">
        <div class="medium-12 columns text-center">
          <p><strong>Funding for this project was provided through a grant from Spencer Foundation</strong></p>
        </div>
      </div>-->

    </footer>
    
    <script src="js/vendor/jquery-2.1.4.min.js"></script>
    <script src="js/vendor/foundation.js"></script>
    <!--<script type="text/javascript" src="../script/jquery.js"></script>
    <script type="text/javascript" src="../script/jquery.callback.js"></script>
    <script type="text/javascript" src="../script/ExportHTMLTable.js"></script>-->

   
  <script>

// Close the dropdown if the user clicks outside of it
window.onclick = function(event) {
  if (!event.target.matches('.dropbtn')) {

    var dropdowns = document.getElementsByClassName("dropdown-content");
    var i;
    for (i = 0; i < dropdowns.length; i++) {
      var openDropdown = dropdowns[i];
      if (openDropdown.classList.contains('show')) {
        openDropdown.classList.remove('show');
      }
    }
  }
  
}
// Get the continue button
var btn = document.getElementById("myBtn");

// Create a "close" button and append it to each list item
/*var myNodelist = document.getElementsByTagName("LI");
var i;
for (i = 0; i < myNodelist.length; i++) {
  var span = document.createElement("SPAN");
  var txt = document.createTextNode("\u00D7");
  span.className = "close";
  span.appendChild(txt);
  myNodelist[i].appendChild(span);
}*/

var strataName=new Array();
// Click on a close button to hide the current list item
var close = document.getElementsByClassName("close");
var i;
var closedNum=0
for (i = 0; i < close.length; i++) {
  close[i].onclick = function() {
    var div = this.parentElement;
    div.style.display = "hide";
  li.splice(i,1);
  }
}

var clickcount=0
var strataInput=new Array();
// When the user clicks the button, save value of dropdown and continue
function generateFunction() {
  var select_value = document.getElementById('selection').value
    var strata=select_value;
  var group1Name = document.getElementById("group1").value;
  var group2Name = document.getElementById("group2").value;
  var subgroup1Name = document.getElementById("subgroup1").value;
  var subgroup2Name = document.getElementById("subgroup2").value;
  var subgroup3Name = document.getElementById("subgroup3").value;
  var outcome = document.getElementById("outcome").value;
  var outcomeUnits = document.getElementById("outcome_units").value;
  if (group1Name==""){group1Name="Treatment"};
  if (group2Name==""){group2Name="Control"};
  if (outcome==""){outcome="Outcome"};
  if (subgroup1Name==""){subgroup1Name="Condition1"};
  if (subgroup2Name==""){subgroup2Name="Condition2"};
  if (subgroup3Name==""){subgroup3Name="Condition3"};
  strataName.push(subgroup1Name);
  strataName.push(subgroup2Name);
  strataName.push(subgroup3Name);
  var table = document.createElement("TABLE");
    //table.border = "20";
  var columnCount = strata;
  

  //Add the data rows.
if (clickcount==0){
  //strataName.unshift(group1Name);
  strataName.unshift("");
    for (var i = 0; i <= columnCount; i++) {
        row = table.insertRow(-1);
        for (var j = 0; j < 1; j++) {
            var cell = row.insertCell(-1);
            cell.innerHTML = strataName[i];
      cell.setAttribute("width",90);
      if (i>0) {cell.classList.add("table-header")}; // x & y header cells
        }
    if(i==0) {
      var cell = row.insertCell(-1);
      cell.innerHTML = "Assigned to " + group1Name;
      cell.setAttribute("colspan",strata+1);
      cell.classList.add("control-treatment-header"); //treatment header
      var row=table.insertRow(-1);
      var cell = row.insertCell(-1);
      cell.innerHTML = "Assigned to " + group2Name;
      cell.setAttribute("rowspan",strata+1);
      cell.classList.add("control-treatment-header"); // control header
      cell.setAttribute("width",80);
      var row=table.insertRow(-1);
    for (var j = 0; j <= columnCount; j++) {
            var cell = row.insertCell(-1);
            cell.innerHTML = strataName[j];
      cell.classList.add("table-header")
        }
    }
    else {
    for (var j = 1; j <= columnCount; j++) {
            var cell = row.insertCell(-1);
      if(i==j){
      strataInput.push("Always takes up " + strataName[i]);
      cell.innerHTML = "Always takes up " + strataName[i];}
            else{
      cell.innerHTML = "Under assignment to "+group1Name+" takes up "+strataName[j]+"; under assignment to "+group2Name+" takes up "+strataName[i];
      }
        }
    }
  }
    var dvTable = document.getElementById("dvTable");
    dvTable.innerHTML = "";
    dvTable.appendChild(table);
  localStorage.group1Local=group1Name;
  localStorage.group2Local=group2Name;
  localStorage.strataLocal=strata;
  document.getElementById('exp').innerHTML = "This matrix displays the "+ strata*strata + " possible strata for your study. Based on the information you entered, participants in the " + group1Name + " and " + group2Name + " groups could have taken up "+subgroup1Name+", "+subgroup2Name+", or "+subgroup3Name+".  On the next page you can eliminate strata for which you think there would be no impacts or that you believe are implausible.";
  }
  if(clickcount==1){
  localStorage.strata1Local=strataName[1];
  localStorage.strata2Local=strataName[2];
  localStorage.strata3Local=strataName[3];
  localStorage.strata4Local=strataName[4];
  localStorage.strata1Input=strataInput[1];
  localStorage.strata2Input=strataInput[2];
  localStorage.strata3Input=strataInput[3];
  localStorage.strata4Input=strataInput[4];
  localStorage.strata5Input=strataInput[5];
  localStorage.strata6Input=strataInput[6];
  localStorage.strata7Input=strataInput[7];
  localStorage.strata8Input=strataInput[8];
  localStorage.strata9Input=strataInput[8];
  localStorage.strata10Input=strataInput[10];
  localStorage.strata11Input=strataInput[11];
  localStorage.strata12Input=strataInput[12];
  localStorage.strata13Input=strataInput[13];
  localStorage.strata14Input=strataInput[14];
  localStorage.strata15Input=strataInput[15];
  localStorage.strata16Input=strataInput[16];
  localStorage.outcome = outcome;
  localStorage.outcomeUnits = outcomeUnits;
  if(strata==3){window.location.href = 'exclusions_3.html';}
  }
  clickcount=clickcount+1;
}


</script>
  </body>
</html>



