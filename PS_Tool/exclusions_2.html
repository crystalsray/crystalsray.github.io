<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Use substantive assumptions to constraints the number of strata for this study</title>
    <link rel="stylesheet" href="css/foundation.min.css">
    <link rel="stylesheet" href="css/app.css">
  </head>
  <body>
    
    <div class="callout large primary">
      <div class="row column text-center">
        <h1>Principal Stratification Tool</h1>
      </div>
    </div>
    
    <div class="row" id="content">

      <div class="medium-3 medium-offset-1 columns" data-sticky-container>
        <div class="sticky" data-sticky data-anchor="content">
          <ol class="menu vertical">
            <li><a href="index.html"><strong>Start &rarr;</strong> Calculating Bounds for Principal Causal Effects: Interactive Analysis Tool</a></li>
            <li><a href="intro_1a.html">Design Requirements</a></li>
			<li><a href="PS_tool.html"> Identify the Principal Strata for your Study</a></li>
            <li class="active"><a href="exclusions_2.html">Use Substantive Assumptions to Restrict the Number of Strata of Interest for these Analyses</a></li>
            <li><!-- pKnown2.html --> Determining Proportions of Subgroups using Observed Quantities</li>
            <li><!-- pUnknown2.html -->Solving for Proportions that are not Directly Observed</li>
            <li><!-- meansIntro2.html -->Solving for Means under Treatment and Control</li>
			<li><!-- means2.html -->Applying the Exclusion Restriction</li>
			<li><!-- meansUnknown2.html -->Solving for the Remaining Means</li>
            <li><!-- bounds_calc2.html -->Calculating the Bounds and Estimating Ranges of Impact</li>
            <li><!-- NextSteps.html -->Next Steps</li>
          </ol>
        </div>
      </div>

      <div class="medium-7 columns">

          <h2>Use substantive assumptions to restrict the number of strata of interest for these analyses</h2>
          
          <p>It is necessary to eliminate one or more of the strata in order to solve for the bounds. In most cases, it is possible to identify these strata based on two substantively driven assumptions. This page will walk you through those assumptions and help to refine your matrix to reflect the context of your study and research questions. </p>

          <h3> The Monotonicity Assumption </h3>
          <p>The monotonicity assumption usually applies to defiers when your groups are defined by a compliance-related behavior. We assume that an individual would be at least as likely to take up the treatment under assignment to the treatment condition as under assignment to the control condition. <b>With this assumption, we are assuming that defiers (those who take up treatment under control, but do not take up treatment under assignment to treatment) do not exist.</b> For example, in the ECHS study, a participant who enrolled in an ECHS under assignment to control and would attend a traditional high school under assignment to treatment would not exist. In the matrix below, click any strata where you think you can apply the monotonicity assumption.</p>


          <table id="monoGrid" class="testgrid" align="center">
            <tr>
              <th colspan=5 class="control-treatment-header" id="group1Name"></th>
            </tr>
            <tr>
              <th rowspan=6 class="control-treatment-header" id="group2Name"></th>
            </tr>
            <tr>
              <th> </th>
              <th id="strata1Name"></th>
              <th id="strata2Name"></th>
            </tr>
            <tr>
              <th id="strata1Name3"></th>
              <td id="strata1InputMono" onclick='tableText11_mono()'> </td>
              <td id="strata2InputMono" onclick='tableText12_mono()'> </td>
            </tr>
            <tr>
              <th id="strata2Name3"></th>
              <td id="strata4InputMono" onclick='tableText21_mono()'> </td>
              <td id="strata5InputMono" onclick='tableText22_mono()'> </td>
            </tr>
          </table>

          <h3>Irrelevant Alternatives</h3>
          <p>Some strata may be theoretically possible but not plausible in the context of your study. For example, in the ECHS example, we would not expect someone to attend a high-quality high school under assignment to control and attend a low-quality high school under assignment to ECHS. <b>It is difficult to imagine the circumstances under which this situation might happen, so we assume these groups do not exist as irrelevant alternatives.</b> There may be similar circumstances in your study. In the matrix below, click any strata which you think represent irrelevant alternatives.</p>

          <table id="irrGrid" class="testgrid" align="center">
            <tr>
              <th colspan=5 class="control-treatment-header" id=group1Name2></th>
            </tr>
            <tr>
              <th rowspan=6 class="control-treatment-header" id=group2Name2></th>
            </tr>
            <tr>
              <th> </th>
              <th id=strata1Name2></th>
              <th id=strata2Name2></th>
            </tr>
            <tr>
              <th id=strata1Name4></th>
              <td id=strata1InputIrr onclick='tableText11_irr()'> </td>
              <td id=strata2InputIrr onclick='tableText12_irr()'> </td>
            </tr>
            <tr>
              <th id=strata2Name4></th>
              <td id=strata4InputIrr onclick='tableText21_irr()'></td>
              <td id=strata5InputIrr onclick='tableText22_irr()'> </td>
            </tr>
          </table>


          

          <div class="row">
            <div class="small-12 text-center">
              <button class="button" onclick="moveToBounds()">Continue</button>
            </div>
          </div>


      </div> <!--/ end medium-7 -->

      
      

      <div class="medium-1 columns">&nbsp;
      </div>

    </div><!-- end row -->
    

    <footer>
      <div class="row expanded callout secondary">
        <div class="medium-10 medium-offset-1 columns">
          <p>Funding for this project was provided by Grant #201500035 from the Spencer Foundation. This website is designed to assist researchers interested in applying a principal stratification approach to their research questions. This tool intended for researchers who have a familiarity with the principal stratification approach. Researchers unfamiliar with the approach are encouraged to consult Page et al 2015 before using this tool.</p>
<br><p>Furey, J., Grindal, T., & Page, L. (2017). Calculating Bounds for Principal Causal Effects: Interactive Analysis Tool (Version 1.0, Software]. Available from <a> www.INSERTPAGE<a>  <p>

        </div>
      </div>


      <!--<div class="row">
        <div class="medium-12 columns text-center">
          <p><strong>Funding for this project was provided through a grant from Spencer Foundation</strong></p>
        </div>
      </div>-->

    </footer>
    
    <script src="js/vendor/jquery-2.1.4.min.js"></script>
    <script src="js/vendor/foundation.js"></script>
    <script>

   window.onload = function() {
        var groupNames= new Array();
        var strataNames = new Array();
        var group1 = localStorage.group1Local;
        var group2 = localStorage.group2Local;
        var strata = localStorage.strataLocal;
        var strata1 = localStorage.strata1Local;
        var strata2 = localStorage.strata2Local;
        var strata3 = localStorage.strata3Local;
        var strata4 = localStorage.strata4Local;
        var strata1Input=localStorage.strata1Input;
        var strata2Input=localStorage.strata2Input;
        var strata3Input=localStorage.strata3Input;
        var strata4Input=localStorage.strata4Input;
        var strata5Input=localStorage.strata5Input;
        var strata6Input=localStorage.strata6Input;
        var strata7Input=localStorage.strata7Input;
        var strata8Input=localStorage.strata8Input;
        var strata9Input=localStorage.strata9Input;
        var strata10Input=localStorage.strata10Input;
        var strata11Input=localStorage.strata11Input;
        var strata12Input=localStorage.strata12Input;
        var strata13Input=localStorage.strata13Input;
        var strata14Input=localStorage.strata14Input;
        var strata15Input=localStorage.strata15Input;
        var strata16Input=localStorage.strata16Input;

        
        groupNames.push(group1);
        groupNames.push(group2);
        strataNames.push(strata1);
        strataNames.push(strata2);
        strataNames.push(strata3);
        strataNames.push(strata4);

        document.getElementById('group1Name').innerHTML = "Assigned to " + group1;
        document.getElementById('group2Name').innerHTML = "Assigned to " + group2;
        document.getElementById('group1Name2').innerHTML = "Assigned to " + group1;
        document.getElementById('group2Name2').innerHTML = "Assigned to " + group2;
        document.getElementById('strata1Name').innerHTML = strata1;
        document.getElementById('strata2Name').innerHTML = strata2;
        document.getElementById('strata1Name2').innerHTML = strata1;
        document.getElementById('strata2Name2').innerHTML = strata2;
        document.getElementById('strata1Name3').innerHTML = strata1;
        document.getElementById('strata2Name3').innerHTML = strata2;
        document.getElementById('strata1Name4').innerHTML = strata1;
        document.getElementById('strata2Name4').innerHTML = strata2;
        document.getElementById("strata1InputMono").innerHTML = "Always takes up "+strata1;
        document.getElementById("strata2InputMono").innerHTML = "Under assignment to to "+group1+" takes up "+strata2+"; under assignment to "+group2+" takes up "+strata1;
        document.getElementById("strata4InputMono").innerHTML = "Under assignment to to "+group1+" takes up "+strata1+"; under assignment to "+group2+" takes up "+strata2;
        document.getElementById('strata5InputMono').innerHTML = "Always takes up "+strata2;
        document.getElementById("strata1InputIrr").innerHTML = "Always takes up "+strata1;
        document.getElementById("strata2InputIrr").innerHTML = "Under assignment to to "+group1+" takes up "+strata2+"; under assignment to "+group2+" takes up "+strata1;
        document.getElementById("strata4InputIrr").innerHTML = "Under assignment to to "+group1+" takes up "+strata1+"; under assignment to "+group2+" takes up "+strata2;
        document.getElementById('strata5InputIrr').innerHTML = "Always takes up "+strata2;
        } 

  


function moveToBounds() {
  localStorage.cell1 = document.getElementById("strata1InputMono").innerHTML;
  localStorage.cell2 = document.getElementById("strata2InputMono").innerHTML;
  localStorage.cell3 = document.getElementById("strata4InputMono").innerHTML;
  localStorage.cell4 = document.getElementById("strata5InputMono").innerHTML;
  //checks on whether enough eliminations
  var countRCACTIVE = 0;
  var count = 0;
  var countRow1 = 0;
  var countRow2 = 0;
  var countColumn1 = 0;
  var countColumn2 = 0;
  if (localStorage.cell1.substring(0,2) == "Al"){
    countRow1 = countRow1 + 1;
    countColumn1 = countColumn1 + 1;
  }
  
  if (localStorage.cell2.substring(0,2) == "Un"){
    countRow1 = countRow1 + 1;
    countColumn2 = countColumn2 + 1;
  }

  if (localStorage.cell3.substring(0,2) == "Un"){
    countRow2 = countRow2 + 1;
    countColumn1 = countColumn1 + 1;
  }
  
  if (localStorage.cell4.substring(0,2) == "Al"){
    countRow2 = countRow2 + 1;
    countColumn2 = countColumn2 + 1;
  }
  

  var isActive = [1,1,1,1];
  var cellsLocal = [localStorage.cell1, localStorage.cell2, localStorage.cell3, localStorage.cell4];
  if (countRow1>=1){countRCACTIVE = countRCACTIVE+1;}
  if (countRow2>=1){countRCACTIVE = countRCACTIVE+1;}
  if (countColumn1>=1){countRCACTIVE = countRCACTIVE+1;}
  if (countColumn2>=1){countRCACTIVE = countRCACTIVE+1;}
  for (var i = 0; i<4 ; i++)
  {
    if(cellsLocal[i].substring(0,2)!="Al" && cellsLocal[i].substring(0,2)!= "Un"){
    count = count + 1;
    isActive[i] = 0;
    }
  }
  localStorage.countRow1 = countRow1;
  localStorage.countRow2 = countRow2;
  localStorage.countColumn1 = countColumn1;
  localStorage.countColumn2 = countColumn2;
  localStorage.isActive1 = isActive[0];
  localStorage.isActive2 = isActive[1];
  localStorage.isActive3 = isActive[2];
  localStorage.isActive4 = isActive[3];

  if(count<1){
               var retVal = confirm("In order to point identify the proportion of participants in each strata, you need to assume away at least (r-1)x(c-1) cells and one cell needs to be “alive” in each row and in each column.  Without this, even the distribution is not point identified.  If you cannot make enough assumptions to fit these criteria, this may not be an appropriate method for your study. Press OK to exit the tool or cancel if you think you made a mistake in your assumptions.");
               if( retVal == true ){
                  window.location.href = 'NextSteps.html';
                  return true;
               }
               else{
                  return false;
               }
	}
  if(countRCACTIVE<4){
               var retVal = confirm("In order to point identify the proportion of participants in each strata, you need to assume away at least (r-1)x(c-1) cells and one cell needs to be “alive” in each row and in each column.  Without this, even the distribution is not point identified.  If you cannot make enough assumptions to fit these criteria, this may not be an appropriate method for your study. Press OK to exit the tool or cancel if you think you made a mistake in your assumptions.");
               if( retVal == true ){
                  window.location.href = 'NextStepsScreen.html';
                  return true;
               }
               else{
                  return false;
               }
	}
	//if (count>4 || countRCACTIVE==0){
  //alert("You can directly solve for the means under both treatment and control and you do not need bounds");
  //window.location.href = 'noBoundsRedirect.html';
  //}
  if (count>=1 & countRCACTIVE==4){window.location.href = 'pKnown2.html';}
  }
var row = new Array();
var column = new Array();

 var table = document.getElementById("irrGrid");
 var table2 = document.getElementById("monoGrid");

var clickcount1 = 0;
var clickcount2 = 0;
var clickcount3 = 0;
var clickcount4 = 0;
var clickcount5 = 0;
var clickcount6 = 0;
var clickcount7 = 0;
var clickcount8 = 0;
var clickcount9 = 0;
var clickcount21 = 0;
var clickcount22 = 0;
var clickcount23 = 0;
var clickcount24 = 0;
var clickcount25 = 0;
var clickcount26 = 0;
var clickcount27 = 0;
var clickcount28 = 0;
var clickcount29 = 0;

    function tableText11_mono() {
	        var group1 = localStorage.group1Local;
        var group2 = localStorage.group2Local;
        var strata = localStorage.strataLocal;
        var strata1 = localStorage.strata1Local;
        var strata2 = localStorage.strata2Local;
        var strata3 = localStorage.strata3Local;
        var strata4 = localStorage.strata4Local;
	if((clickcount1%2)==0){
    document.getElementById("strata1InputMono").innerHTML = "Monotonicity Assumption";
    document.getElementById("strata1InputIrr").innerHTML = "Monotonicity Assumption";
    document.getElementById("strata1InputMono").classList.add("blue-cell");
    document.getElementById("strata1InputIrr").classList.add("blue-cell");
	}
	if((clickcount1%2)==1){
	document.getElementById("strata1InputMono").innerHTML = "Always takes up "+strata1;
    document.getElementById("strata1InputIrr").innerHTML = "Always takes up "+strata1;
	document.getElementById("strata1InputMono").classList.remove("blue-cell");
    document.getElementById("strata1InputIrr").classList.remove("blue-cell");
	}
	clickcount1 = clickcount1 + 1;
    }

    function tableText12_mono() {
	        var group1 = localStorage.group1Local;
        var group2 = localStorage.group2Local;
        var strata = localStorage.strataLocal;
        var strata1 = localStorage.strata1Local;
        var strata2 = localStorage.strata2Local;
        var strata3 = localStorage.strata3Local;
        var strata4 = localStorage.strata4Local;
	if((clickcount2%2)==0){
    document.getElementById("strata2InputMono").innerHTML = "Monotonicity Assumption";
    document.getElementById("strata2InputIrr").innerHTML = "Monotonicity Assumption";
    document.getElementById("strata2InputMono").classList.add("blue-cell");
    document.getElementById("strata2InputIrr").classList.add("blue-cell");
	}
	if((clickcount2%2)==1){
	document.getElementById("strata2InputMono").innerHTML = "Under assignment to to "+group1+" takes up "+strata2+"; under assignment to "+group2+" takes up "+strata1;
    document.getElementById("strata2InputIrr").innerHTML = "Under assignment to to "+group1+" takes up "+strata2+"; under assignment to "+group2+" takes up "+strata1;
	document.getElementById("strata2InputMono").classList.remove("blue-cell");
    document.getElementById("strata2InputIrr").classList.remove("blue-cell");
	}
		clickcount2 = clickcount2 + 1;

    }

     function tableText21_mono() {
	        var group1 = localStorage.group1Local;
        var group2 = localStorage.group2Local;
        var strata = localStorage.strataLocal;
        var strata1 = localStorage.strata1Local;
        var strata2 = localStorage.strata2Local;
        var strata3 = localStorage.strata3Local;
        var strata4 = localStorage.strata4Local;
	if((clickcount4%2)==0){
    document.getElementById("strata4InputMono").innerHTML = "Monotonicity Assumption";
    document.getElementById("strata4InputIrr").innerHTML = "Monotonicity Assumption";
    document.getElementById("strata4InputMono").classList.add("blue-cell");
    document.getElementById("strata4InputIrr").classList.add("blue-cell");
	}
	if((clickcount4%2)==1){
	document.getElementById("strata4InputMono").innerHTML = "Under assignment to to "+group1+" takes up "+strata1+"; under assignment to "+group2+" takes up "+strata2;
    document.getElementById("strata4InputIrr").innerHTML = "Under assignment to to "+group1+" takes up "+strata1+"; under assignment to "+group2+" takes up "+strata2;
	document.getElementById("strata4InputMono").classList.remove("blue-cell");
    document.getElementById("strata4InputIrr").classList.remove("blue-cell");
	}
		clickcount4 = clickcount4 + 1;

    }

    function tableText22_mono() {
	        var group1 = localStorage.group1Local;
        var group2 = localStorage.group2Local;
        var strata = localStorage.strataLocal;
        var strata1 = localStorage.strata1Local;
        var strata2 = localStorage.strata2Local;
        var strata3 = localStorage.strata3Local;
        var strata4 = localStorage.strata4Local;
	if((clickcount5%2)==0){
    document.getElementById("strata5InputMono").innerHTML = "Monotonicity Assumption";
    document.getElementById("strata5InputIrr").innerHTML = "Monotonicity Assumption";
    document.getElementById("strata5InputMono").classList.add("blue-cell");
    document.getElementById("strata5InputIrr").classList.add("blue-cell");
	}
	if((clickcount5%2)==1){
	document.getElementById("strata5InputMono").innerHTML = "Always takes up "+strata2;
    document.getElementById("strata5InputIrr").innerHTML = "Always takes up "+strata2;
	document.getElementById("strata5InputMono").classList.remove("blue-cell");
    document.getElementById("strata5InputIrr").classList.remove("blue-cell");
	}
		clickcount5 = clickcount5 + 1;

    }

  function tableText11_irr() {
	        var group1 = localStorage.group1Local;
        var group2 = localStorage.group2Local;
        var strata = localStorage.strataLocal;
        var strata1 = localStorage.strata1Local;
        var strata2 = localStorage.strata2Local;
        var strata3 = localStorage.strata3Local;
        var strata4 = localStorage.strata4Local;
	if((clickcount21%2)==0){
    document.getElementById("strata1InputMono").innerHTML = "Irrelevant Alternative";
    document.getElementById("strata1InputIrr").innerHTML = "Irrelevant Alternative";
    document.getElementById("strata1InputMono").classList.add("blue-cell");
    document.getElementById("strata1InputIrr").classList.add("blue-cell");
	}
	if((clickcount21%2)==1){
	document.getElementById("strata1InputMono").innerHTML = "Always takes up "+strata1;
    document.getElementById("strata1InputIrr").innerHTML = "Always takes up "+strata1;
	document.getElementById("strata1InputMono").classList.remove("blue-cell");
    document.getElementById("strata1InputIrr").classList.remove("blue-cell");
	}
		clickcount21 = clickcount21 + 1;

    }

    function tableText12_irr() {
	        var group1 = localStorage.group1Local;
        var group2 = localStorage.group2Local;
        var strata = localStorage.strataLocal;
        var strata1 = localStorage.strata1Local;
        var strata2 = localStorage.strata2Local;
        var strata3 = localStorage.strata3Local;
        var strata4 = localStorage.strata4Local;
	if((clickcount22%2)==0){
    document.getElementById("strata2InputMono").innerHTML = "Irrelevant Alternative";
    document.getElementById("strata2InputIrr").innerHTML = "Irrelevant Alternative";
    document.getElementById("strata2InputMono").classList.add("blue-cell");
    document.getElementById("strata2InputIrr").classList.add("blue-cell");
	}
	if((clickcount22%2)==1){
	document.getElementById("strata2InputMono").innerHTML = "Under assignment to to "+group1+" takes up "+strata2+"; under assignment to "+group2+" takes up "+strata1;
    document.getElementById("strata2InputIrr").innerHTML = "Under assignment to to "+group1+" takes up "+strata2+"; under assignment to "+group2+" takes up "+strata1;
	document.getElementById("strata2InputMono").classList.remove("blue-cell");
    document.getElementById("strata2InputIrr").classList.remove("blue-cell");
	}
		clickcount22 = clickcount22 + 1;

    }
  function tableText21_irr() {
	        var group1 = localStorage.group1Local;
        var group2 = localStorage.group2Local;
        var strata = localStorage.strataLocal;
        var strata1 = localStorage.strata1Local;
        var strata2 = localStorage.strata2Local;
        var strata3 = localStorage.strata3Local;
        var strata4 = localStorage.strata4Local;
	if((clickcount24%2)==0){
    document.getElementById("strata4InputMono").innerHTML = "Irrelevant Alternative";
    document.getElementById("strata4InputIrr").innerHTML = "Irrelevant Alternative";
    document.getElementById("strata4InputMono").classList.add("blue-cell");
    document.getElementById("strata4InputIrr").classList.add("blue-cell");
	}
	if((clickcount24%2)==1){
	document.getElementById("strata4InputMono").innerHTML = "Under assignment to to "+group1+" takes up "+strata1+"; under assignment to "+group2+" takes up "+strata2;
    document.getElementById("strata4InputIrr").innerHTML = "Under assignment to to "+group1+" takes up "+strata1+"; under assignment to "+group2+" takes up "+strata2;
	document.getElementById("strata4InputMono").classList.remove("blue-cell");
    document.getElementById("strata4InputIrr").classList.remove("blue-cell");
	}
		clickcount24 = clickcount24 + 1;

    }

    function tableText22_irr() {
	        var group1 = localStorage.group1Local;
        var group2 = localStorage.group2Local;
        var strata = localStorage.strataLocal;
        var strata1 = localStorage.strata1Local;
        var strata2 = localStorage.strata2Local;
        var strata3 = localStorage.strata3Local;
        var strata4 = localStorage.strata4Local;
	if((clickcount25%2)==0){
    document.getElementById("strata5InputMono").innerHTML = "Irrelevant Alternative";
    document.getElementById("strata5InputIrr").innerHTML = "Irrelevant Alternative";
    document.getElementById("strata5InputMono").classList.add("blue-cell");
    document.getElementById("strata5InputIrr").classList.add("blue-cell");
	}
	if((clickcount25%2)==1){
	document.getElementById("strata5InputMono").innerHTML = "Always takes up "+strata2;
    document.getElementById("strata5InputIrr").innerHTML = "Always takes up "+strata2;
	document.getElementById("strata5InputMono").classList.remove("blue-cell");
    document.getElementById("strata5InputIrr").classList.remove("blue-cell");
	}
		clickcount25 = clickcount25 + 1;

    }

  
    </script>
  </body>
</html>



